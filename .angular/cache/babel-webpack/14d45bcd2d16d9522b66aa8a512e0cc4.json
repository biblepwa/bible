{"ast":null,"code":"import _asyncToGenerator from \"/home/john/code/Bible_pwa/bible/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { DOCUMENT } from '@angular/common';\nimport * as wasm from '../../../pkg';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../bible.service\";\nimport * as i2 from \"../history.service\";\nimport * as i3 from \"@angular/platform-browser\";\nimport * as i4 from \"../safe.pipe\";\nexport let DisplayBookComponent = /*#__PURE__*/(() => {\n  class DisplayBookComponent {\n    constructor(bibleService, historyService, title, meta, document) {\n      this.bibleService = bibleService;\n      this.historyService = historyService;\n      this.title = title;\n      this.meta = meta;\n      this.document = document;\n      this.renderedBook = wasm.render(this.bibleService.testament, this.bibleService.bookSelected);\n      this.historyService.newBook();\n      this.meta.addTag({\n        name: 'description',\n        content: 'An opensource, offline capable (PWA), King James Version (Cambridge) Bible application'\n      });\n    }\n\n    ngOnInit() {}\n\n    ngAfterViewInit() {\n      window.scroll(0, Number(localStorage.getItem('curScrollY'))); // store book for loading on return, if not chosen from history -MUST BE UNDER ngAfterViewInit \n\n      this.historyService.storeBooks(); // change tab title on load\n\n      let tabTitle = this.bibleService.title.concat(' ', localStorage.getItem('curChap'));\n      this.title.setTitle(tabTitle); // save chapters on scroll\n\n      const chapters = this.document.querySelectorAll(\"section\");\n      const options = {\n        root: null,\n        threshold: [0],\n        rootMargin: \"-50%\" //highlight multiple chapters if visible\n\n      };\n      this.observer = new IntersectionObserver(function (entries) {\n        entries.forEach(entry => {\n          let chapter = entry.target.querySelector(\"div\").id;\n\n          if (entry.isIntersecting) {\n            localStorage.setItem('curChap', chapter);\n          } else {\n            if (window.pageYOffset < this.scroll && chapter != \"1\") {\n              //chapter !- 1 ; necessary if history book - will result in chapter 0.\n              let newChap = (Number(chapter) - 1).toString();\n              localStorage.setItem('curChap', newChap);\n            }\n          }\n\n          this.scroll = window.pageYOffset;\n        });\n      }, options);\n      chapters.forEach(chapter => {\n        this.observer.observe(chapter);\n      });\n    }\n\n    scrolled() {\n      // change chapter numbers in tab title as scrolling\n      let tabTitle = this.bibleService.title.concat(' ', localStorage.getItem('curChap'));\n      this.title.setTitle(tabTitle);\n      localStorage.setItem('curScrollY', window.pageYOffset.toString());\n    }\n\n    ngOnDestroy() {\n      var _this = this;\n\n      return _asyncToGenerator(function* () {\n        // store scroll position and chapter on exit\n        _this.historyService.savePosition();\n      })();\n    }\n\n  }\n\n  DisplayBookComponent.ɵfac = function DisplayBookComponent_Factory(t) {\n    return new (t || DisplayBookComponent)(i0.ɵɵdirectiveInject(i1.BibleService), i0.ɵɵdirectiveInject(i2.HistoryService), i0.ɵɵdirectiveInject(i3.Title), i0.ɵɵdirectiveInject(i3.Meta), i0.ɵɵdirectiveInject(DOCUMENT));\n  };\n\n  DisplayBookComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: DisplayBookComponent,\n    selectors: [[\"app-display-book\"]],\n    hostBindings: function DisplayBookComponent_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵlistener(\"scroll\", function DisplayBookComponent_scroll_HostBindingHandler() {\n          return ctx.scrolled();\n        }, false, i0.ɵɵresolveWindow)(\"beforeunload\", function DisplayBookComponent_beforeunload_HostBindingHandler() {\n          return ctx.ngOnDestroy();\n        }, false, i0.ɵɵresolveWindow);\n      }\n    },\n    decls: 2,\n    vars: 4,\n    consts: [[3, \"innerHTML\", \"click\"]],\n    template: function DisplayBookComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵlistener(\"click\", function DisplayBookComponent_Template_div_click_0_listener() {\n          ctx.bibleService.showChapters = false;\n          return ctx.bibleService.displayMenu = false;\n        });\n        i0.ɵɵpipe(1, \"safe\");\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"innerHTML\", i0.ɵɵpipeBind2(1, 1, ctx.renderedBook, \"html\"), i0.ɵɵsanitizeHtml);\n      }\n    },\n    pipes: [i4.SafePipe],\n    styles: [\"[_ngcontent-%COMP%]:root{--nav: #ccc;--paper: #fff;--gridColor: #eee;--searchHighlight: #ccc;--ink: #000;--zPaper: #bbb;--zInk: #111;--scriptNum: #777;--button: #999;--buttonActive: #ddd;--buttonBorder: #777;--darkRed: #4b0101;--lightRed: #8A0707}html[dataTheme=dark][_ngcontent-%COMP%]{--nav: #444;--paper: #000;--gridColor: #111;--searchHighlight: #333;--ink: #fff;--zPaper: #333;--zInk: #ddd;--button: #777;--scriptNum: #777;--buttonActive: #aaa;--buttonBorder: #333;--darkRed: #4b0101;--lightRed: #8A0707}html[_ngcontent-%COMP%]{scroll-behavior:smooth}body[_ngcontent-%COMP%]{color:var(--ink);background-color:var(--paper);margin:auto;font-size:1.1rem}hr[_ngcontent-%COMP%]{border-color:var(--lightRed)}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], h4[_ngcontent-%COMP%], h5[_ngcontent-%COMP%]{font-family:Georgia,\\\"Times New Roman\\\",Times,serif;font-weight:normal}  .fontType{font-family:Georgia,\\\"Times New Roman\\\",Times,serif;line-height:1.45em;font-size:1.3rem}@media (max-width: 1000px){  .fontType{font-size:1.2rem}}@media (max-width: 768px){  .fontType{font-size:1.1rem}}  .headings{text-align:center}  .headings  h5,   .headings   h2,   .headings   h3,   .headings   h4{margin-top:.5rem;margin-bottom:.5rem}  .psalm{text-align:center;font-size:1rem}@media (max-width: 1000px){  .psalm{font-size:.9rem}}@media (max-width: 768px){  .psalm{font-size:.8rem}}  .verses{display:grid;width:100%;grid-gap:1rem;grid-template-columns:3rem auto}@media (max-width: 767px){  .verses{grid-template-columns:1rem auto}}  .firstVerse{margin-left:3rem;margin-right:1rem;margin-bottom:.3rem}  .firstVerse:first-of-type:first-letter{float:left;margin-bottom:0;margin-right:.03rem;vertical-align:top;font-size:2rem}@media (max-width: 767px){  .firstVerse{margin-left:1rem}}  .verseNumber{text-align:right;color:var(--scriptNum);margin:.5rem 0}@media (max-width: 767px){  .verseNumber{margin:.3rem 0}}  .scripture{margin:.5rem 1rem .5rem 0}@media (max-width: 767px){  .scripture{margin:.3rem 1rem .3rem 0}}  .notes{font-style:italic;font-size:.9rem;text-align:center;margin-left:3rem;margin-right:3rem}  .active{animation:result 3s ease 1s}  .active .verseNumber{color:var(--lightRed)}@keyframes result{33%{background-color:var(--searchHighlight)}66%{background-color:var(--searchHighlight)}}\"]\n  });\n  return DisplayBookComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}